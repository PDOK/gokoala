{{- /*gotype: github.com/PDOK/gokoala/internal/engine.TemplateData*/ -}}
{{define "content"}}

<script>
  function gotoFeatures(format, selectId) {
    const crs = document.getElementById(selectId).value;
    const baseURL = "{{ .Config.BaseURL }}/collections/{{ .Params.Collection.ID }}/items";
    let url;
    if (crs === "https://www.opengis.net/def/crs/OGC/1.3/CRS84") {
      // Use the static URL for WGS84
      url = `${baseURL}?f=${format}`;
    } else {
      url = `${baseURL}?f=${format}&crs=${crs}`;
    }
    window.open(url, '_blank');
  }
</script>

{{/* structed data for this collection, see https://developers.google.com/search/docs/appearance/structured-data/dataset.
  test any changes using https://search.google.com/test/rich-results */}}
<script type="application/ld+json">
{
    "@context": "https://schema.org/",
    "@type": "Dataset",
    "isPartOf": "{{ .Config.BaseURL }}?f=html",
    "name": "{{ .Config.Title }} - {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Title }}{{ .Params.Collection.Metadata.Title }}{{ else }}{{ .Params.Collection.ID }}{{ end }}",
    {{- if and .Params.Collection.Metadata .Params.Collection.Metadata.Description (gt (len .Params.Collection.Metadata.Description) 50) }}
    "description": "{{ unmarkdown .Params.Collection.Metadata.Description  }}",
    {{- end }}
    "url": "{{ .Config.BaseURL }}/collections/{{ .Params.Collection.ID }}?f=html",
    {{- if and .Params.Collection.Metadata .Params.Collection.Metadata.Keywords -}}
    "keywords": [
      {{- range $i, $k := .Params.Collection.Metadata.Keywords -}}
      {{- if $i -}},{{- end -}}"{{ $k }}"
      {{- end -}}
    ],
    {{- end -}}
    "license": "{{ .Config.License.URL }}",
    "isAccessibleForFree": true
    {{- if and .Params.Collection.Metadata .Params.Collection.Metadata.Thumbnail }}
    ,"thumbnailUrl": "{{ .Config.BaseURL }}/resources/{{ .Params.Collection.Metadata.Thumbnail }}"
    {{- end }}
    {{- if and .Params.Collection.Metadata .Params.Collection.Metadata.LastUpdated }}
    ,"version": "{{ toDate "2006-01-02T15:04:05Z07:00" .Params.Collection.Metadata.LastUpdated | date "2006-01-02" }}"
    {{- end }}
}
</script>

<hgroup>
    <h1 class="title h2" id="title">{{ .Config.Title }} - {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Title }}{{ .Params.Collection.Metadata.Title }}{{ else }}{{ .Params.Collection.ID }}{{ end }}</h1>
</hgroup>

<div class="row py-3">
    {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Thumbnail }}
    <div class="col-md-8">
    {{ else }}
    <div class="col-md-12">
    {{ end }}
        {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Description }}
            {{ markdown .Params.Collection.Metadata.Description }}
        {{ end }}
        <table class="table table-borderless table-sm w-100">
            <caption class="visually-hidden">Collection details</caption>
            <tbody>
                {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Keywords }}
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                        {{ i18n "Keywords" }}:
                    </td>
                    <td class="text-break">
                        {{ .Params.Collection.Metadata.Keywords | join ", " }}
                    </td>
                </tr>
                {{ end }}
                {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.LastUpdated }}
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                        {{ i18n "LastUpdated" }}:
                    </td>
                    <td>
                        {{ toDate "2006-01-02T15:04:05Z07:00" .Params.Collection.Metadata.LastUpdated | date "2006-01-02" }}
                    </td>
                </tr>
                {{ end }}
                {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Extent }}
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                        {{ i18n "GeographicExtent" }}
                        {{ if .Params.Collection.Metadata.Extent.Srs }}
                            (<a href="http://www.opengis.net/def/crs/EPSG/0/{{ trimPrefix "EPSG:" .Params.Collection.Metadata.Extent.Srs }}" target="_blank"
                                aria-label="{{ i18n "To" }} {{ .Params.Collection.Metadata.Extent.Srs }} {{ i18n "Definition" }}">{{ .Params.Collection.Metadata.Extent.Srs }}</a>):
                        {{ else }}
                            (<a href="http://www.opengis.net/def/crs/OGC/1.3/CRS84" target="_blank"
                                aria-label="{{ i18n "To" }} CRS84 {{ i18n "Definition" }}">CRS84</a>):
                        {{ end }}
                    </td>
                    <td>
                        {{ .Params.Collection.Metadata.Extent.Bbox | join ", " }}
                    </td>
                </tr>
                {{ end }}
                {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Extent .Params.Collection.Metadata.Extent.Interval }}
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                        {{ i18n "TemporalExtent" }} (<a href="http://www.opengis.net/def/uom/ISO-8601/0/Gregorian" target="_blank" aria-label="{{ i18n "To" }} ISO-8601 {{ i18n "Definition" }}">ISO-8601</a>):
                    </td>
                    <td>
                        {{ toDate "2006-01-02T15:04:05Z" ((first .Params.Collection.Metadata.Extent.Interval) | replace "\"" "") | date "2006-01-02" }} /
                        {{ if not (contains "null" (last .Params.Collection.Metadata.Extent.Interval)) }}{{ toDate "2006-01-02T15:04:05Z" ((last .Params.Collection.Metadata.Extent.Interval) | replace "\"" "") | date "2006-01-02" }}{{ else }}..{{ end }}
                    </td>
                </tr>
                {{ end }}
            </tbody>
        </table>
    </div>
    {{ if and .Params.Collection.Metadata .Params.Collection.Metadata.Thumbnail }}
    <div class="col-md-4">
        <img src="resources/{{ .Params.Collection.Metadata.Thumbnail }}" class="img-fluid" alt="{{ .Params.Collection.ID }} Thumbnail"/>
    </div>
    {{ end }}
</div>

<!-- start specific part per OGC spec -->
<div class="row row-cols-md-4 g-4">

    {{ if and .Config.OgcAPI.GeoVolumes .Config.OgcAPI.GeoVolumes.Collections }}
        {{ if .Config.OgcAPI.GeoVolumes.Collections.ContainsID .Params.Collection.ID }}
            <div class="col-md-4 col-sm-12">
                <div class="card h-100">
                    <h2 class="card-header h5">
                        3D GeoVolumes
                    </h2>
                    <div class="card-body">
                        <ul>
                            {{ if and .Params.Collection.GeoVolumes .Params.Collection.GeoVolumes.Has3DTiles }}
                                <li>{{ i18n "GoTo" }} <a href="{{ .Config.BaseURL }}/collections/{{ .Params.Collection.ID }}/3dtiles" aria-label="{{ i18n "GoTo"}} 3D Tiles">3D Tiles</a></li>
                            {{ end }}
                            {{ if and .Params.Collection.GeoVolumes .Params.Collection.GeoVolumes.HasDTM }}
                                <li>{{ i18n "GoTo" }} <a href="{{ .Config.BaseURL }}/collections/{{ .Params.Collection.ID }}/quantized-mesh" aria-label="{{ i18n "GoTo"}} Quantized Mesh DTM">Quantized Mesh DTM</a></li>
                            {{ end }}
                            {{ if and .Params.Collection.GeoVolumes .Params.Collection.GeoVolumes.URL3DViewer }}
                                <li>{{ i18n "ViewIn" }} <a href="{{ .Params.Collection.GeoVolumes.URL3DViewer }}" target="_blank" aria-label="{{ i18n "ViewIn" }} 3D Viewer">3D Viewer</a></li>
                            {{ end }}
                        </ul>
                    </div>
                </div>
            </div>
        {{ end }}
    {{ end }}

    {{ if and .Config.OgcAPI.Tiles .Config.OgcAPI.Tiles.Collections }}
        {{ if .Config.OgcAPI.Tiles.Collections.ContainsID .Params.Collection.ID }}
            <div class="col-md-4 col-sm-12">
                <div class="card h-100">
                    <h2 class="card-header h5">
                        <a href="{{ .Config.BaseURL }}/collections/{{ .Params.Collection.ID }}/tiles" aria-label="{{ i18n "To" }} Tiles">Tiles</a>
                    </h2>
                    <div class="card-body">
                        <p>
                            {{ i18n "CollectionTilesHTML" }} {{ if .Config.OgcAPI.Styles }}{{ i18n "WithStylesHTML" }}{{ end }}
                        </p>
                    </div>
                </div>
            </div>
        {{ end }}
    {{ end }}

    {{ if and .Config.OgcAPI.Features .Config.OgcAPI.Features.Collections }}
        {{ if .Config.OgcAPI.Features.Collections.ContainsID .Params.Collection.ID }}
            <div class="col-md-4 col-sm-12">
                <div class="card h-100">
                    <h2 class="card-header h5">
                        <a href="{{ .Config.BaseURL }}/collections/{{ .Params.Collection.ID }}/items" aria-label="{{ i18n "Browse" }} Features">Features</a>
                    </h2>
                    <div class="card-body">
                        <p>
                            {{ i18n "Browse" }} <a href="{{ .Config.BaseURL }}/collections/{{ .Params.Collection.ID }}/items" aria-label="{{ i18n "Browse" }} Features">Features</a> {{ i18n "BrowseSuffix" }}:
                        </p>
                        <p>
                            <ul>
                            {{ range $availableFormat := $.Params.Type.AvailableOutputFormats }}
                               <li> <label for="select{{ $availableFormat.Key }}" class="visually-hidden">{{ i18n "To" }} Features in</label>
                                <select id="select{{ $availableFormat.Key }}">
                                    <option value="https://www.opengis.net/def/crs/OGC/1.3/CRS84">CRS84</option>
                                    {{ range $index, $srs := $.Config.OgcAPI.Features.CollectionSRS $.Params.Collection.ID }}
                                        {{ $crs := printf "http://www.opengis.net/def/crs/EPSG/0/%s" (trimPrefix "EPSG:" $srs) }}
                                        <option value="{{ $crs }}">{{ $srs }}</option>
                                    {{ end }}
                                </select>
                                {{ i18n "As" }}
                                <a href="{{ $.Config.BaseURL }}/collections/{{ $.Params.Collection.ID }}" onclick="gotoFeatures('{{ $availableFormat.Key }}', 'select{{ $availableFormat.Key }}'); return false;">{{ $availableFormat.Value }}</a>.
                               </li>
                            {{ end }}
                            </ul>
                        </p>
                        <p>
                            {{ i18n "BrowseSchema" }} <a href="{{ $.Config.BaseURL }}/collections/{{ $.Params.Collection.ID }}/schema">Schema</a> {{ i18n "BrowseSchemaSuffix" }}.
                        </p>
                        {{ if eq $.Params.Type "features" }}
                        <div class="alert alert-primary" role="alert">
                            <small>{{ i18n "FeaturesExplanation" }}</small>
                        </div>
                        {{ end }}
                    </div>
                </div>
            </div>
        {{ end }}
    {{ end }}

    {{ if and .Params.Collection.Links .Params.Collection.Links.Downloads }}
        <div class="col-md-4 col-sm-12">
            <div class="card h-100">
                <h2 class="card-header h5">
                    Downloads
                </h2>
                <div class="card-body">
                    <ul>
                        {{ range $link := .Params.Collection.Links.Downloads -}}
                            <li><a href="{{ $link.AssetURL }}" target="_blank" aria-label="{{ $link.Name }}">{{ $link.Name }}{{ if $link.Size }} ({{ $link.Size }}){{ end }}</a></li>
                        {{ end }}
                    </ul>
                </div>
            </div>
        </div>
    {{ end }}

</div>
<!-- end specific part per OGC spec -->
{{end}}
