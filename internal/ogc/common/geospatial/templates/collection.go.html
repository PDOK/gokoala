{{- /*gotype: github.com/PDOK/gokoala/internal/engine.TemplateData*/ -}}
{{define "content"}}
<hgroup>
    <h1 class="title h2" id="title">{{ .Config.Title }} - {{ if and .Params.Metadata .Params.Metadata.Title }}{{ .Params.Metadata.Title }}{{ else }}{{ .Params.ID }}{{ end }}</h1>
</hgroup>

<div class="row py-3">
    <div class="col-md-8">
        <div class="card-body">
            {{ if and .Params.Metadata .Params.Metadata.Description }}
                {{ markdown .Params.Metadata.Description }}
            {{ end }}
        </div>
        <div class="card-body">
            {{ if and .Params.Metadata .Params.Metadata.Keywords }}
            <table class="table table-borderless table-sm w-100">
                <tbody>
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                    <strong>{{ i18n "Keywords" }}</strong>:
                    </td>
                <td>
                    {{ .Params.Metadata.Keywords | join ", " }}
                </td>
                </tr>
            {{ end }}

            {{/* <li class="list-group-item"><strong>Schema</strong>: TODO link to collection schema</li> */}}
            {{ if and .Params.Metadata .Params.Metadata.LastUpdated }}
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                    <strong>{{ i18n "LastUpdated" }}</strong>:
                    </td>
                    <td>
                    {{ toDate "2006-01-02T15:04:05Z07:00" .Params.Metadata.LastUpdated | date "2006-01-02" }}
                    </td>
                </tr>
            {{ end }}

            {{ if and .Params.Metadata .Params.Metadata.Extent }}
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                        <strong>{{ i18n "GeographicExtent" }}</strong>
                    {{ if .Params.Metadata.Extent.Srs }}
                        (<a href="http://www.opengis.net/def/crs/EPSG/0/{{ trimPrefix "EPSG:" .Params.Metadata.Extent.Srs }}" target="_blank"
                            aria-label="{{ i18n "To" }} {{ .Params.Metadata.Extent.Srs }} {{ i18n "Definition" }}">{{ .Params.Metadata.Extent.Srs }}</a>):
                    </td>
                    {{ else }}
                        (<a href="http://www.opengis.net/def/crs/OGC/1.3/CRS84" target="_blank"
                            aria-label="{{ i18n "To" }} CRS84 {{ i18n "Definition" }}">CRS84</a>):
                    {{ end }}
                    <td>
                        {{ .Params.Metadata.Extent.Bbox | join ", " }}
                    </td>
                </tr>
            {{ end }}

            {{ if and .Params.Metadata .Params.Metadata.Extent .Params.Metadata.Extent.Interval }}
                <tr>
                    <td class="w-25 text-nowrap fw-bold">
                        <strong>{{ i18n "TemporalExtent" }}</strong>
                        (<a href="http://www.opengis.net/def/uom/ISO-8601/0/Gregorian" target="_blank" aria-label="{{ i18n "To" }} ISO-8601 {{ i18n "Definition" }}">ISO-8601</a>):
                    </td>
                    <td>
                        {{ toDate "2006-01-02T15:04:05Z" ((first .Params.Metadata.Extent.Interval) | replace "\"" "") | date "2006-01-02" }} /
                        {{ if not (contains "null" (last .Params.Metadata.Extent.Interval)) }}{{ toDate "2006-01-02T15:04:05Z" ((last .Params.Metadata.Extent.Interval) | replace "\"" "") | date "2006-01-02" }}{{ else }}..{{ end }}
                    </td>
                </tr>
            {{ end }}
                </tbody>
            </table>
        </div>
    </div>

    <div class="col-md-4">
        {{ if and .Config.Thumbnail .Config.Resources }}
        <div class="col-md-12">
            <img src="resources/{{ .Config.Thumbnail }}" class="img-fluid" alt="{{ .Config.Title }} Thumbnail"/>
        </div>
        {{ end }}
    </div>
        <!-- start specific part per OGC spec -->
        {{ if and .Config.OgcAPI.GeoVolumes .Config.OgcAPI.GeoVolumes.Collections }}
          {{ if .Config.OgcAPI.GeoVolumes.Collections.ContainsID .Params.ID }}
            <div class="col-md-4  col-sm-12">
                <div class="card h-100">
                    <h2 class="card-header h5">3D GeoVolumes</h2>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <ul>
                                    {{ if and .Params.GeoVolumes .Params.GeoVolumes.Has3DTiles }}
                                        <li>{{ i18n "GoTo" }} <a href="{{ .Config.BaseURL }}/collections/{{ .Params.ID }}/3dtiles" aria-label="{{ i18n "GoTo"}} 3D Tiles">3D Tiles</a></li>
                                    {{ end }}
                                    {{ if and .Params.GeoVolumes .Params.GeoVolumes.HasDTM }}
                                        <li>{{ i18n "GoTo" }} <a href="{{ .Config.BaseURL }}/collections/{{ .Params.ID }}/quantized-mesh" aria-label="{{ i18n "GoTo"}} Quantized Mesh DTM">Quantized Mesh DTM</a></li>
                                    {{ end }}
                                    {{ if and .Params.GeoVolumes .Params.GeoVolumes.URL3DViewer }}
                                        <li>{{ i18n "ViewIn" }} <a href="{{ .Params.GeoVolumes.URL3DViewer }}" target="_blank" aria-label="{{ i18n "ViewIn" }} 3D Viewer">3D Viewer</a></li>
                                    {{ end }}
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        {{ end }}
          {{ end }}

    {{ if and .Config.OgcAPI.Tiles .Config.OgcAPI.Tiles.Collections }}
        {{ if .Config.OgcAPI.Tiles.Collections.ContainsID .Params.ID }}
        <div class="col-md-4 col-sm-12">
            <div class="card h-100">
                <h2 class="card-header h5">Tiles</h2>
                <div class="card-body">
                    <ul class="list-group">
                        <li class="list-group-item">TODO (placeholder)</li>
                    </ul>
                </div>
            </div>
        </div>
        {{ end }}
    {{ end }}

    {{ if and .Config.OgcAPI.Features .Config.OgcAPI.Features.Collections }}
        {{ if .Config.OgcAPI.Features.Collections.ContainsID .Params.ID }}
        <div class="col-md-4 col-sm-12">
            <div class="card h-100">
                    <h2 class="card-header h5">Features</h2>
                    <div class="card-body">
                                <p>
                                  <strong>{{ i18n "Browse" }} <a href="{{ .Config.BaseURL }}/collections/{{ .Params.ID }}/items" aria-label="{{ i18n "Browse" }} Features">Features</a></strong>
                                </p>

                                <p>
                                    <label for="selectGeojson">{{ i18n "GoTo" }} features in</label>
                                    <select id="selectGeojson">
                                        <option value="http://www.opengis.net/def/crs/EPSG/0/4326">WGS84</option>
                                        {{ range $index, $srs := .Config.OgcAPI.Features.ProjectionsForCollection .Params.ID }}
                                            {{ $crs := printf "http://www.opengis.net/def/crs/EPSG/0/%s" (trimPrefix "EPSG:" $srs) }}
                                            <option value="{{ $crs }}">{{ $srs }}</option>
                                        {{ end }}
                                    </select>
                                    <text>as</text>
                                    <a href="#" onclick="gotoFeatures('json', 'selectGeojson'); return false;">GeoJSON</a>
                                </p>

                                {{ if .Config.OgcAPI.Features.Datasources.Additional  }}
                                <p>
                                    <label for="selectJsonfg">{{ i18n "GoTo" }} features in</label>
                                    <select id="selectJsonfg">
                                        {{ range $index, $srs := .Config.OgcAPI.Features.ProjectionsForCollection .Params.ID }}
                                            {{ $crs := printf "http://www.opengis.net/def/crs/EPSG/0/%s" (trimPrefix "EPSG:" $srs) }}
                                            <option value="{{ $crs }}">{{ $srs }}</option>
                                        {{ end }}
                                    </select>
                                    <text>as</text>
                                    <a href="#" onclick="gotoFeatures('jsonfg', 'selectJsonfg'); return false;">JSONFG</a>
                                </p>
                                {{ end }}
                            <br/>
                            <div class="alert alert-primary" role="alert">
                                {{ i18n "FeaturesExplanation" }}
                            </div>
                    </div>
                </div>
            </div>
        {{ end }}
    {{ end }}

    {{ if and .Params.Links .Params.Links.Downloads }}
        <div class="col-md-4 col-sm-12">
          <div class="card h-100">
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <h3 class="card-title h5">Downloads</h3>
                    <li class="list-group-item">
                <h3 class="card-title h5">Downloads</h3>
                <ul>
                {{- range $link := .Params.Links.Downloads -}}
                    <li><a href="{{ $link.AssetURL }}" target="_blank" aria-label="{{ $link.Name }}">{{ $link.Name }}{{ if $link.Size }} ({{ $link.Size }}){{ end }}</a></li>
                {{ end }}
                </ul>
                </li>
            </ul>
          </div>
            </div>>
    {{ end }}
    <!-- end specific part per OGC spec -->

    <script>
        function gotoFeatures(format, selectId) {
            const crs = document.getElementById(selectId).value;
            const baseURL = "{{ $.Config.BaseURL }}/collections/{{ $.Params.ID }}/items";
            let url;
            if (crs === "http://www.opengis.net/def/crs/EPSG/0/4326") {
                // Use the static URL for WGS84
                url = `${baseURL}?f=json`;
            } else {
                url = `${baseURL}?f=${format}&crs=${crs}`;
            }

            if (event.ctrlKey) {
                window.open(url, '_blank');
            } else {
                window.location.href = url;
            }
        }
    </script>
{{end}}
</div>
